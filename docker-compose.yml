version: "3.8"
services:
      # --- SERVICE 1 : La Base de Données ---
      db:
            image: mysql:8.0
            container_name: myvault_db
            restart: always
            environment:
                  MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
                  MYSQL_DATABASE: ${DB_DATABASE}
                  MYSQL_USER: ${DB_USER}
                  MYSQL_PASSWORD: ${DB_PASSWORD}
            volumes:
                  - db_data:/var/lib/mysql # Pour ne pas perdre les données si on éteint !

      # --- SERVICE 2 : Votre Site Web ---
      www:
            build: . # Construit l'image à partir du Dockerfile courant
            container_name: myvault_web
            ports:
                  - "8080:80" # On accèdera au site via localhost:8080
            depends_on:
                  - db # Attend que la BDD soit prête
            environment:
                  # C'est ici qu'on "injecte" la configuration vers PHP
                  B_NAME: ${DB_DATABASE}
                  DB_USER: ${DB_USER}
                  DB_PASS: ${DB_PASSWORD}
                  ENCRYPTION_KEY: ${ENCRYPTION_KEY}
volumes:
      db_data:
